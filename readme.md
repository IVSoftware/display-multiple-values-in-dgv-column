# display-multiple-values-in-dgv-column

Example of a `DataGridView` with a custom `DataGridComboBoxColumn` that has drop down options that are tailored for each user. Something like this:

![screenshot](https://github.com/IVSoftware/display-multiple-values-in-dgv-column/blob/master/display_/ReadMe/screenshot.png)

I'd like to offer a guideline example showing one way this outcome could be realized. 

***
**DataSource for ComboBox**

First, there will be a `BindingList<string>` that will serve as the data source of a `DataGridViewComboBoxColumn`. We'll start with _all_ possible values but this **will** change. When when a new cell is selected its contents will be modified based on the individual `CreditUser` that has been selected.

    // Initialize with all allowed types. This list will be modified
    // whenever the cell selection is changed in the DGV. 
    // Initialize with all allowed types. This list will be modified
    // whenever the cell selection is changed in the DGV. 
    private readonly BindingList<string> ResponsibleList = new BindingList<string>
    {
        String.Empty,
        "Production", 
        "Distribution", 
        "Customer Service", 
        "Sales"
    };

***
What I did for testing is initialize the `dataGridViewCreditUser` with a binding list named `CreditUsers` that in the override of `OnLoad` (there's no need to have the form subscribe to its own  `Load` event). Allow me to explain what I've done and you can modify this flow to your specific requirements.

    
    readonly BindingList<CreditUser> CreditUsers = new BindingList<CreditUser>();
    protected override void OnLoad(EventArgs e)
    {
        dataGridViewCreditUser.DataSource = CreditUsers;

Adding one or more items will autogenerate the columns.

        foreach (var creditUser in mockMainForm_srv_GetCreditUser("", ""))
        {
            CreditUsers.Add(creditUser);
        }


Create a ComboBox column that will be swapped out for the autogenerated one. This is where `AllowedCustomerTypeForUser` becomes the `DataSource` for the `ComboBox` and that won't change even though the items it contains _will_.

        var colCB = new DataGridViewComboBoxColumn
        {
            Name = nameof(CreditUser.CustomerType),
            DataPropertyName = nameof(CreditUser.CustomerType),
            HeaderText = "Customer Type",
            AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells,
            DataSource = ResponsibleList,
        };

Perform the swap.

        var index = dataGridViewCreditUser.Columns[nameof(CreditUser.CustomerType)].Index;
        dataGridViewCreditUser.Columns.RemoveAt(index);
        dataGridViewCreditUser.Columns.Insert(1, colCB);

        // Cancel the known exception caused by clearing the data source.
        dataGridViewCreditUser.DataError += (sender, e) =>
        {
                // This transitory state is caused by AllowedCustomerTypeForUser.Clear();
                e.Cancel = e.Exception.Message == "DataGridViewComboBoxCell value is not valid.";
        };

Subscribe to event such that allowed customer types will update when cell selection changes

        dataGridViewCreditUser.CurrentCellChanged += (sender, e) =>
        {
            if (dataGridViewCreditUser.CurrentCell != null)
            {
                var creditUser = CreditUsers[dataGridViewCreditUser.CurrentCell.RowIndex];
                Text = creditUser.ToString(); // Update title bar.
                var colCB = ((DataGridViewComboBoxColumn)dataGridViewCreditUser.Columns[nameof(CreditUser.CustomerType)]);
                AllowedCustomerTypeForUser.Clear();
                foreach (var allowedType in creditUser.AllowedCustomerTypes)
                {
                    AllowedCustomerTypeForUser.Add(allowedType);
                }
            }
        };

Make sure the cell is NOT left in an editing state after change of ComboBox or CheckBox.

        dataGridViewCreditUser.CurrentCellDirtyStateChanged += (sender, e) =>
        {
            switch (dataGridViewCreditUser.Columns[dataGridViewCreditUser.CurrentCell.ColumnIndex].Name)
            {
                case nameof(CreditUser.CustomerType):
                case nameof(CreditUser.Restricted):
                    dataGridViewCreditUser.CommitEdit(DataGridViewDataErrorContexts.Commit);
                    break;
            }
        };

To monitor ongoing changes, update the Title bar whenever the source list is modified.

        CreditUsers.ListChanged += (sender, e) =>
        {
            if (dataGridViewCreditUser.CurrentCell != null)
            {
                var creditUser = CreditUsers[dataGridViewCreditUser.CurrentCell.RowIndex];
                Text = creditUser.ToString();
            }
        };

Now that the `DataGridView` is all set up the columns can be formatted.

        foreach (DataGridViewColumn col in dataGridViewCreditUser.Columns)
        {
            if (col.Name == nameof(CreditUser.UserName))
            {
                col.AutoSizeMode = DataGridViewAutoSizeColumnMode.Fill;
            }
            else
            {
                col.AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells;
            }
        }
    }

***
**MOCK QUERY FOR TESTING**

    // MOCK for minimal example
    private List<CreditUser> mockMainForm_srv_GetCreditUser(string v1, string v2)
    {
        return new List<CreditUser>
        {
            new CreditUser
            {
                UserName = "Tom",
                CreditLimit=10000m,
                AllowedCustomerTypes = new List<string>
                { 
                    "Production", 
                    "Distribution", 
                    String.Empty 
                },
            },
            new CreditUser
            {
                UserName = "Richard",
                CreditLimit=1250m,
                AllowedCustomerTypes = new List<string>
                { 
                    "Distribution", 
                    "Customer Service", 
                    String.Empty 
                },
                Restricted = true
            },
            new CreditUser
            {
                UserName = "Harry",
                CreditLimit=10000m,
                AllowedCustomerTypes = new List<string>
                { 
                    "Production", 
                    "Customer Service", 
                    "Sales", 
                    String.Empty 
                },
            },
        };
    }
